<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simple Weather App</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;background:linear-gradient(180deg,#071023 0%, #071833 60%);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .container{width:100%;max-width:760px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:20px;box-shadow:0 6px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.04)}
    h1{margin:0 0 12px;font-size:20px}
    form{display:flex;gap:8px;margin-bottom:14px}
    input[type="text"]{flex:1;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:var(--card);color:inherit;font-size:16px}
    button{padding:12px 16px;border-radius:8px;border:0;background:var(--accent);color:#052023;font-weight:600;cursor:pointer}
    button:disabled{opacity:0.6;cursor:not-allowed}
    .card{background:var(--card);padding:18px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
    .row{display:flex;gap:16px;align-items:center}
    .left{flex:1}
    .temp{font-size:54px;font-weight:700;line-height:1}
    .small{color:var(--muted);font-size:13px}
    .condition{display:flex;gap:12px;align-items:center}
    .cond-img{width:64px;height:64px}
    .meta{margin-top:10px;display:flex;gap:12px;flex-wrap:wrap}
    .pill{background:var(--glass);padding:8px 10px;border-radius:999px;font-size:13px;color:var(--muted)}
    .error{color:#ffb4b4;background:rgba(255,80,80,0.06);padding:8px;border-radius:8px;margin-top:12px}
    .loader{width:18px;height:18px;border-radius:50%;border:3px solid rgba(255,255,255,0.08);border-top-color:var(--accent);animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    footer{margin-top:12px;font-size:13px;color:var(--muted)}
    @media (max-width:600px){.temp{font-size:40px}.row{flex-direction:column;align-items:flex-start}.condition{gap:8px}}
  </style>
</head>
<body>
  <div class="container" role="main">
    <h1>Simple Weather App</h1>
    <p class="small">Type a city or location (city name, postal code, or coordinates). Uses WeatherAPI's <code>/current.json</code> endpoint.</p>

    <form id="searchForm" onsubmit="return false;" aria-label="Search location">
      <label for="locationInput" class="sr-only">Location</label>
      <input id="locationInput" type="text" placeholder="e.g. London or 10001 or 37.77,-122.42" value="London" aria-label="Location input">
      <button id="fetchBtn" type="submit">Get Weather</button>
    </form>

    <div id="result" class="card" aria-live="polite">
      <div id="placeholder" class="small">Enter a location and press &quot;Get Weather&quot; to fetch current temperature.</div>
    </div>

    <div id="error" class="error" style="display:none" role="alert"></div>

    <footer>
      <div class="small">Note: This example uses the API key directly in client-side code which is convenient for quick demos but not secure for production. See instructions below for a safer approach.</div>
    </footer>
  </div>

  <script>
    // === CONFIG: replace API_KEY if you want to use a different key ===
    const API_KEY = 'fe57daac84fa42c69ed44804250611';
    const BASE_URL = 'http://api.weatherapi.com/v1/current.json';

    const form = document.getElementById('searchForm');
    const input = document.getElementById('locationInput');
    const fetchBtn = document.getElementById('fetchBtn');
    const result = document.getElementById('result');
    const placeholder = document.getElementById('placeholder');
    const errorBox = document.getElementById('error');

    function showError(msg){
      errorBox.textContent = msg;
      errorBox.style.display = 'block';
    }
    function clearError(){ errorBox.style.display = 'none'; errorBox.textContent = ''; }

    function renderLoading(){
      result.innerHTML = '<div class="row"><div class="loader" aria-hidden="true"></div><div class="small" style="margin-left:10px">Fetching weather...</div></div>';
    }

    function renderWeather(data){
      const loc = data.location;
      const cur = data.current;
      const aqi = cur.air_quality || null;

      const iconUrl = cur.condition && cur.condition.icon ? 'https:' + cur.condition.icon : '';
      const html = `
        <div class="row">
          <div class="left">
            <div class="small">${escapeHtml(loc.name)}, ${escapeHtml(loc.region)}, ${escapeHtml(loc.country)}</div>
            <div class="temp">${Math.round(cur.temp_c)}°C <span class="small">(${Math.round(cur.temp_f)}°F)</span></div>
            <div class="small">Feels like ${Math.round(cur.feelslike_c)}°C · Humidity ${cur.humidity}% · Wind ${cur.wind_kph} kph</div>
            <div class="meta">
              <div class="pill">Local time: ${escapeHtml(loc.localtime)}</div>
              <div class="pill">Last updated: ${escapeHtml(cur.last_updated)}</div>
              <div class="pill">UV: ${cur.uv}</div>
            </div>
          </div>
          <div class="condition">
            ${iconUrl ? `<img src="${iconUrl}" alt="${escapeHtml(cur.condition.text)}" class="cond-img">` : ''}
            <div>
              <div style="font-weight:600">${escapeHtml(cur.condition.text)}</div>
              <div class="small">Cloud: ${cur.cloud}% · Pressure: ${cur.pressure_mb} mb</div>
            </div>
          </div>
        </div>
      `;

      let aqiHtml = '';
      if(aqi){
        // show a few AQI components if present
        const comps = [];
        if(aqi['pm2_5']!==undefined) comps.push('PM2.5: ' + round(aqi['pm2_5']));
        if(aqi['pm10']!==undefined) comps.push('PM10: ' + round(aqi['pm10']));
        if(aqi['us-epa-index']!==undefined) comps.push('EPA index: ' + aqi['us-epa-index']);
        if(comps.length) aqiHtml = `<div style="margin-top:12px" class="small">Air quality — ${comps.join(' · ')}</div>`;
      }

      result.innerHTML = html + aqiHtml;
    }

    function round(v){ return Math.round((v + Number.EPSILON) * 10)/10; }

    function escapeHtml(str){
      if(!str && str !== 0) return '';
      return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    async function fetchWeather(location){
      clearError();
      renderLoading();
      fetchBtn.disabled = true;
      try{
        const q = encodeURIComponent(location);
        const url = `${BASE_URL}?key=${API_KEY}&q=${q}&aqi=yes`;
        const resp = await fetch(url);
        if(!resp.ok){
          // try to show a message from API
          const text = await resp.text();
          throw new Error(`HTTP ${resp.status} — ${text}`);
        }
        const data = await resp.json();

        if(data && data.current){
          renderWeather(data);
        } else {
          throw new Error('Unexpected response from API');
        }
      }catch(err){
        result.innerHTML = '';
        showError('Could not fetch weather. ' + err.message);
      }finally{
        fetchBtn.disabled = false;
      }
    }

    // Submit handler
    form.addEventListener('submit', ()=>{
      const loc = input.value.trim();
      if(!loc){ showError('Please enter a location'); return; }
      fetchWeather(loc);
    });

    // allow Enter key in input
    input.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ e.preventDefault(); form.dispatchEvent(new Event('submit')); } });

    // fetch default on load
    window.addEventListener('load', ()=>{
      // pre-populated value is 'London' — fetch immediately
      const initial = input.value.trim();
      if(initial) fetchWeather(initial);
    });
  </script>
</body>
</html>
